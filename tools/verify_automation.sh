#!/bin/bash\n\n# Daily Newsletter Automation - Quick Verification Script\n# Run this to verify the GitHub Actions loop is ready\n\nset -e  # Exit on error\n\necho \"üîç Brief Delights - Daily Automation Verification\"\necho \"================================================\"\necho \"\"\n\n# Colors\nGREEN='\\033[0;32m'\nRED='\\033[0;31m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\n# Track issues\nISSUES=0\n\n# 1. Check GitHub Actions workflow file\necho \"[1/6] Checking GitHub Actions workflow...\"\nif [ -f \".github/workflows/daily_newsletter.yml\" ]; then\n    echo -e \"${GREEN}‚úÖ Workflow file exists${NC}\"\n    \n    # Check cron schedule\n    if grep -q \"cron: '0 6 \\* \\* \\*'\" .github/workflows/daily_newsletter.yml; then\n        echo -e \"${GREEN}‚úÖ Cron schedule: 6 AM UTC (7 AM CET)${NC}\"\n    else\n        echo -e \"${RED}‚ùå Cron schedule not found or incorrect${NC}\"\n        ((ISSUES++))\n    fi\nelse\n    echo -e \"${RED}‚ùå Workflow file missing${NC}\"\n    echo \"   Expected: .github/workflows/daily_newsletter.yml\"\n    ((ISSUES++))\nfi\necho \"\"\n\n# 2. Check environment variables\necho \"[2/6] Checking local environment variables...\"\nif [ -f \".env\" ]; then\n    echo -e \"${GREEN}‚úÖ .env file exists${NC}\"\n    \n    # Check required keys\n    declare -a REQUIRED_KEYS=(\"OPENROUTER_API_KEY\" \"RESEND_API_KEY\")\n    for key in \"${REQUIRED_KEYS[@]}\"; do\n        if grep -q \"^${key}=\" .env; then\n            echo -e \"${GREEN}   ‚úÖ $key found${NC}\"\n        else\n            echo -e \"${RED}   ‚ùå $key missing${NC}\"\n            ((ISSUES++))\n        fi\n    done\nelse\n    echo -e \"${RED}‚ùå .env file not found${NC}\"\n    ((ISSUES++))\nfi\necho \"\"\n\n# 3. Check subscribers file\necho \"[3/6] Checking subscribers data...\"\nif [ -f \"subscribers.json\" ]; then\n    COUNT=$(jq 'length' subscribers.json 2>/dev/null || echo \"0\")\n    if [ \"$COUNT\" -gt 0 ]; then\n        echo -e \"${GREEN}‚úÖ subscribers.json exists with $COUNT subscribers${NC}\"\n    else\n        echo -e \"${YELLOW}‚ö†Ô∏è  subscribers.json exists but appears empty${NC}\"\n        echo \"   Add at least one subscriber to test emails\"\n    fi\nelse\n    echo -e \"${RED}‚ùå subscribers.json not found${NC}\"\n    echo \"   Pipeline needs this file (or GitHub Secret SUBSCRIBERS_JSON)\"\n    ((ISSUES++))\nfi\necho \"\"\n\n# 4. Check Python dependencies\necho \"[4/6] Checking Python environment...\"\nif command -v python3 &> /dev/null; then\n    PYTHON_VERSION=$(python3 --version)\n    echo -e \"${GREEN}‚úÖ Python installed: $PYTHON_VERSION${NC}\"\n    \n    if [ -f \"requirements.txt\" ]; then\n        echo -e \"${GREEN}   ‚úÖ requirements.txt found${NC}\"\n    else\n        echo -e \"${RED}   ‚ùå requirements.txt missing${NC}\"\n        ((ISSUES++))\n    fi\nelse\n    echo -e \"${RED}‚ùå Python 3 not found${NC}\"\n    ((ISSUES++))\nfi\necho \"\"\n\n# 5. Check pipeline script\necho \"[5/6] Checking pipeline script...\"\nif [ -f \"execution/run_daily_pipeline.py\" ]; then\n    echo -e \"${GREEN}‚úÖ Pipeline script exists${NC}\"\nelse\n    echo -e \"${RED}‚ùå execution/run_daily_pipeline.py not found${NC}\"\n    ((ISSUES++))\nfi\necho \"\"\n\n# 6. GitHub Actions status (requires gh CLI)\necho \"[6/6] Checking GitHub repository status...\"\nif command -v gh &> /dev/null; then\n    echo \"Fetching latest workflow runs...\"\n    gh run list --workflow=daily_newsletter.yml --limit 3 2>/dev/null || echo -e \"${YELLOW}‚ö†Ô∏è  Could not fetch workflow runs (you may need to login: gh auth login)${NC}\"\nelse\n    echo -e \"${YELLOW}‚ö†Ô∏è  GitHub CLI not installed (optional)${NC}\"\n    echo \"   Install: brew install gh\"\n    echo \"   Manual check: https://github.com/LinusInnovator/brief-delights/actions\"\nfi\necho \"\"\n\n# Summary\necho \"================================================\"\necho \"VERIFICATION SUMMARY\"\necho \"================================================\"\n\nif [ $ISSUES -eq 0 ]; then\n    echo -e \"${GREEN}‚úÖ ALL CHECKS PASSED!${NC}\"\n    echo \"\"\n    echo \"Your daily automation is ready to run!\"\n    echo \"\"\n    echo \"Next steps:\"\n    echo \"1. Verify GitHub Secrets are set:\"\n    echo \"   https://github.com/LinusInnovator/brief-delights/settings/secrets/actions\"\n    echo \"\"\n    echo \"2. Test manually:\"\n    echo \"   https://github.com/LinusInnovator/brief-delights/actions\"\n    echo \"   ‚Üí Click 'Daily Newsletter Pipeline' ‚Üí 'Run workflow'\"\n    echo \"\"\n    echo \"3. Wait for tomorrow 7 AM CET for automatic run!\"\nelse\n    echo -e \"${RED}‚ùå FOUND $ISSUES ISSUE(S)${NC}\"\n    echo \"\"\n    echo \"Please fix the issues above before relying on automation.\"\n    echo \"\"\n    echo \"Need help? Check: daily_automation_verification_guide.md\"\nfi\n\necho \"\"\nexit $ISSUES\n
